@if (isOpen()) {
<div class="terminal-backdrop" (click)="close()">
  <div class="terminal-window glass-panel" (click)="$event.stopPropagation()">
    
    <!-- Title Bar -->
    <div class="terminal-header">
      <div class="terminal-title">
        <span class="icon">_</span> TERMINAL_ACCESS // {{ (profile$ | async)?.name }}
      </div>
      <div class="terminal-controls">
        <button class="btn-control close" (click)="close()" title="Close">X</button>
      </div>
    </div>

    <!-- Output Area -->
    <div class="terminal-body" #terminalBody (contextmenu)="onRightClick($event)">
      @for (log of logs(); track $index) {
        <div class="log-entry" [ngClass]="log.type">
          <span class="timestamp">[{{ log.timestamp | date:'HH:mm:ss' }}]</span>
          @switch (log.type) {
            @case ('input') {
              <span class="prompt">> </span>
            }
            @case ('error') {
              <span class="error-prefix">ERR: </span>
            }
            @case ('system') {
              <span class="system-prefix">SYS: </span>
            }
            @case ('ai') {
              <span class="ai-prefix">AI EXTERNAL SYSTEM: </span>
            }
          }
          <span class="content" [innerHTML]="linkify(log.content)"></span>
        </div>
      }

      <!-- Input Line -->
      <div class="input-line">
        <span class="prompt">guest@portfolio:~$</span>
        <textarea 
          #commandInput
          [(ngModel)]="currentCommand" 
          (keydown.enter)="onEnter($event)"
          (keydown.arrowup)="navigateHistory('up', $event)"
          (keydown.arrowdown)="navigateHistory('down', $event)"
          (input)="autoResize()"
          rows="1"
          autofocus
          spellcheck="false"
          autocomplete="off"
        ></textarea>
      </div>
    </div>

  </div>
</div>
}
